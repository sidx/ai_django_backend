!function(){"use strict";function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}if("webkitSpeechRecognition"in window){var t="Speak now",n=6,a=document.getElementsByClassName("speech-input");[].forEach.call(a,function(a){function s(){g=setTimeout(function(){w.stop()},1e3*c)}var i,l,r,o,c=parseInt(a.dataset.patience,10)||n,d=a.nextSibling,u=a.parentNode,p=parseInt(getComputedStyle(a).borderRightWidth,10),h=.8*(a.dataset.buttonsize||a.offsetHeight);!a.dataset.buttonsize&&"TEXTAREA"===a.tagName&&h>26&&(h=26);var m=a.parentNode;m.classList.contains("si-wrapper")||(m=document.createElement("div"),m.classList.add("si-wrapper"),m.appendChild(u.removeChild(a)),o=!0),i=m.querySelector(".si-btn"),i||(i=document.createElement("button"),i.type="button",i.classList.add("si-btn"),i.textContent="speech input",l=document.createElement("span"),r=document.createElement("span"),l.classList.add("si-mic"),r.classList.add("si-holder"),i.appendChild(l),i.appendChild(r),m.appendChild(i),i.style.cursor="pointer",i.style.top=.125*h+"px",i.style.height=i.style.width=h+"px",a.style.paddingRight=h-p+"px"),o&&u.insertBefore(m,d);var v,g,f="",b=!1,y=null,w=new webkitSpeechRecognition;w.continuous=!0,w.interimResults=!0,a.lang&&(w.lang=a.lang),w.onstart=function(){y=a.placeholder,a.placeholder=a.dataset.ready||t,b=!0,i.classList.add("listening"),s()},w.onend=function(){b=!1,clearTimeout(g),i.classList.remove("listening"),null!==y&&(a.placeholder=y),void 0!==a.dataset.instantSubmit&&a.value&&$("button.message-submit").click()};var C="";w.onresult=function(t){clearTimeout(g);for(var n=t.results,i="",l=t.resultIndex;l<n.length;++l){var r=n[l],o=r[0];r.isFinal?C+=o.transcript:i+=o.transcript}var c=C||i;c=!f||v?e(c):c,a.value=f+c,a.focus(),"INPUT"===a.tagName?a.scrollLeft=a.scrollWidth:a.scrollTop=a.scrollHeight,s()},i.addEventListener("click",function(e){if(e.preventDefault(),b)return void w.stop();var t=a.value.slice(-1).match(/\s/);f=!a.value||t?a.value:a.value+" ",v=f.trim().slice(-1).match(/[\.\?\!]/),C="",w.start()},!1)})}}();